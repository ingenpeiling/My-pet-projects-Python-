# Splitting the Cost

## Краткое описание
Скрипт для компаний, которые дарят один подарок от всех на день рождения. Если каждый участник купил какую-то часть общего подарка (цветы, торт, сам подарок и т.п.), то траты окажутся неравными. Скрипт посчитает, сколько денег каждый участник должен перевести другим, чтобы траты у всех оказались равными.

## Входные данные
[Пример входных данных](input_splitting_the_cost.txt).
На вход принимается файл формата txt, где указаны три пункта: 
1. Occasion - повод (день рождения, вечеринка и т.п.),
2. People - имена участников,
3. Items - список трат, где указаны название предмета, имя купившего и цена.

## Принцип работы
1. Скрипт создает реляционную базу данных для хранения информации. База содержит 4 таблицы: `occasions`, `people`, `items` и `transactions`. [Схема базы данных](database_scheme_splitting_the_cost.jpg).
2. Обрабатывается файл txt, данные из него сохраняются в таблицы `occasions`, `people` и `items`.
3. С помощью триггеров в базе данных вычисляются `total_amount` (сколько всего было потрачено) и `initial_amount` (сколько изначально потратил каждый участник).
4. Находится число участников и вычисляется `right_amount` - сколько каждый должен потратить, чтобы траты каждого были равными.
5. Создается словарь `names_amounts`, где ключ - id участника из базы данных, а значение - потраченная им сумма (`initial_amount`). Словарь сортируется по убыванию от наибольшей суммы к наименьшей. Пример: `{4: 2200, 3: 1600, 2: 1000, 1: 200}`.
6.  Вычисляется, сколько денег должен прислать другим каждый участник. Данные сохраняются в словарь `who_sends_what`, где ключ - id отправителя, а значение - список списков, где каждый список состоит из двух элементов: id получателя и сумма, которую нужно отправить. Пример: `{3: [[4, 150]], 2: [[3, 150], [4, 300]], 1: [[2, 200], [3, 350], [4, 500]]}`.
7.  Данные из `who_sends_what` сохраняются в таблицу `transactions` в базе данных.
8.  С помощью триггера в базе данных вычисляется `final_amount` - каковы будут траты каждого участника после проведения всех транзакций.
9.  Значение `final_amount` каждого участника сравнивается с `right_amount`. Проверка пройдена успешно, если `final_amount` = `right_amount` +- 2. Отклонение +-2 возможно в связи с округлением сумм в предыдущих вычислениях. Если проверка не пройдена, пользователь получает сообщение об ошибке.
10.  Результат записывается в копию исходного txt файла.

## Результат работы
[Пример результата](result_splitting_the_cost.txt).
Создается копия исходного файла txt, и к исходной информации добавляются несколько разделов. Раздел To do содержит инструкции, кто из участников сколько должен отдать другим, чтобы траты стали равными. Разделы Overview и Explanation поясняют, как происходили расчеты.

## Код
[Ссылка на код](splitting_the_cost.py)
